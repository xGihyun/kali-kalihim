---
import Layout from "@/components/layouts/layout.astro";
import UserProfile from "@/components/user/profile";
import UpcomingMatch from "@/components/user/upcoming-match";
import PreviousMatches from "@/components/user/previous-matches";
import PowerCards from "@/components/user/power-cards";
import { db } from "@/drizzle/db";
import { getPowerCards } from "@/lib/server/power-cards";
import { getPreviousMatches, getUpcomingMatch } from "@/lib/server/matches";
import { ArnisSeasonsTable } from "@/drizzle/schema";
import { desc } from "drizzle-orm";
import type { PlayerPowerCard } from "@/lib/types/player";
import type {
  UpcomingMatchResponseData,
  PreviousMatchResponseData,
} from "@/lib/types/match";

// TODO: Remove this once proper auth is implemented
//const currentUser = "b00d9f00-0b8a-478d-8240-fa7090d06fb4";

type LoadData = {
  powerCards: PlayerPowerCard[];
  upcomingMatch: UpcomingMatchResponseData | null;
  previousMatches: PreviousMatchResponseData[];
};

//const data: LoadData = await db.transaction(async (tx) => {
//  const [latestSeason] = await tx
//    .select({ arnisSeasonId: ArnisSeasonsTable.arnisSeasonId })
//    .from(ArnisSeasonsTable)
//    .orderBy(desc(ArnisSeasonsTable.createdAt))
//    .limit(1);
//
//  const powerCards = await getPowerCards(tx, userId);
//  const upcomingMatch = await getUpcomingMatch(
//    tx,
//    userId,
//    latestSeason.arnisSeasonId,
//  );
//  const previousMatches = await getPreviousMatches(
//    tx,
//    userId,
//    latestSeason.arnisSeasonId,
//  );
//
//  return {
//    powerCards,
//    upcomingMatch,
//    previousMatches,
//  };
//});
---

<Layout title="Home">
  <div class="flex gap-4">
    <UserProfile />

    <div class="flex w-full flex-col gap-4">
      HELLO THERE
      <!--<PowerCards powerCards={data.powerCards} />-->
      <!--<UpcomingMatch match={data.upcomingMatch} />-->
      <!--<PreviousMatches matches={data.previousMatches} />-->
    </div>
  </div>
</Layout>
