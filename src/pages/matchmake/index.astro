---
import Layout from "@/components/layouts/layout.astro";
import MatchmakeForm from "./_components/matchmake";
import { db } from "@/drizzle/db";
import {
  ArnisSeasonsTable,
  ArnisTechniquesTable,
  SectionsTable,
} from "@/drizzle/schema";
import type { ArnisSeasonModel, ArnisTechniqueModel } from "@/lib/types/arnis";
import type { SectionModel } from "@/lib/types/player";

type LoadData = {
  arnisTechniques: ArnisTechniqueModel[];
  sections: SectionModel[];
  arnisSeasons: ArnisSeasonModel[];
};

const data: LoadData = await db.transaction(async (tx) => {
  const arnisTechniques = await tx.select().from(ArnisTechniquesTable);
  const sections = await tx.select().from(SectionsTable);
  const arnisSeasons = await tx.select().from(ArnisSeasonsTable);

  return {
    arnisSeasons,
    sections,
    arnisTechniques,
  };
});
---

<Layout title="Matchmake">
  <MatchmakeForm
    arnisTechniques={data.arnisTechniques}
    sections={data.sections}
    arnisSeasons={data.arnisSeasons}
    client:load
  />
</Layout>
